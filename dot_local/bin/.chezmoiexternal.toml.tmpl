{{- define "bin" -}}
{{- if or (isExecutable (joinPath .chezmoi.homeDir ".local" "bin" .name)) (not (lookPath .name)) -}}
[{{ .name | quote }}]
{{
 (omit . "name" "chezmoi")
 | setValueAtPath "executable" true
 | setValueAtPath "refreshPeriod" "24h"
 | toToml
}}
{{- end -}}
{{- end -}}

{{- $chezmoi := .chezmoi -}}
{{- $clang_arch := get (dict "amd64" "x86_64") .chezmoi.arch -}}


{{ range $name := (list "app2unit" "app2unit-open" "app2unit-open-scope" "app2unit-open-service" "app2unit-term" "app2unit-term-scope" "app2unit-term-service") -}}
{{ template "bin" (dict
 "name" $name
 "type" "archive-file"
 "url" "https://github.com/Vladimir-csp/app2unit/archive/refs/heads/master.tar.gz"
 "stripComponents" 1
 "path" $name
 "chezmoi" $chezmoi
) }}
{{- end }}

{{ template "bin" (dict
 "name" "carapace"
 "type" "archive-file"
 "url" (gitHubLatestReleaseAssetURL "carapace-sh/carapace-bin" (printf "carapace-bin_*_%s_%s.tar.gz" .chezmoi.os .chezmoi.arch))
 "path" "carapace"
 "chezmoi" $chezmoi
) }}

{{ template "bin" (dict
 "name" "meteor"
 "type" "archive-file"
 "url" (gitHubLatestReleaseAssetURL "stefanlogue/meteor" (printf "meteor-%s-%s.zip" .chezmoi.os .chezmoi.arch))
 "path" "meteor"
 "chezmoi" $chezmoi
) }}

{{ range $name := (list "nu" "nu_plugin_formats" "nu_plugin_gstat" "nu_plugin_inc" "nu_plugin_polars" "nu_plugin_query") -}}
{{ template "bin" (dict
 "name" $name
 "type" "archive-file"
 "url" (gitHubLatestReleaseAssetURL "nushell/nushell" (printf "nu-*-%s-*-%s-*.tar.gz" $clang_arch $chezmoi.os))
 "stripComponents" 1
 "path" $name
 "chezmoi" $chezmoi
) }}
{{- end }}
